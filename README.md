# Evraz.RailWorkshop
Программная система документооборота ведомостей движения
рельсовой продукции в рельсобалочном производстве, автоматизирующая документооборот ведомостей приемки и отгрузки для
учета движения рельсобалочной продукции.

# API

#### Запуск приложения (локально)

0. Организовать Postgres сервер и создать в нем пустую базу.
1. В проекте RailWorkshop.Db в файле Options.cs установить строку подключения к базе данных.
2. В проекте базы данных две миграции, одна создает модель, вторая заполняет таблицы тестовыми данными. Их обе нужно применить к базе.
3. Можно запускать.

> На 09.01.2024 полноценно реализованы контроллер авторизации и контроллер справочников.

#### Авторизация

Авторизация происходит по Bearer токену. Чтобы получить токен нужно отпарвить запрос `/api/auth/{login}/{password}`. Далее токен нужно вставлять во все запросы. 

Предусмотрено 2 роли: Admin и Employee. Для Admin логин = `Admin`, пароль = `12345678`. Для Employee логином является имя, имена и хэш паролей сотрудников храняться в базе данных. Пароль по умолчанию для сотрудников = `123`.

#### Контроллеры

**HandbookController** - контроллер справочников. Предоставляет доступ к справочникам для авторизованных пользователей. Для роли Admin предоставляет возможность создавать, обновлять и редактировать сущности справочников.

Всего 4 справочника:
0. Defect - тип дефекта продукции.
1. SteelGrade - марка стали.
2. RailProfile - профиль рельса.
3. WorkshopSegment - сегмент цеха, например "Прокатный стан - Приемка", "Холодильник - Склад". Бизнес логика приложения завязана на перемещении продукции между этими сегментами.

Для справочников реализован универсальный репозиторий HandbookRepository. Это обеспечит лекгое расширение списка справчоников если это потребуется.

Эндпоинты:
- [GET] `api/handbooks/{handbook}` - получить все сущности справочника.
- [GET] `api/handbooks/{handbook}/{id}` - получить сущность справочника по id.
- [POST][PUT][DELETE] `api/handbooks/{handbook}` - создать, обновить, удалить соответственно. Ожидают json со свойствами сущности справочника. (Доступны только для Admin)

> При создании, обновлении и удалении сущностей предусмотрено логирование в файл /bin/server.log. Логируются и неудачные попытки, а так же информация от служб Microsoft и контекста базы данных.

**EmployeeController** - контролер сотрудников цеха. Участвует в процессе аутентификации. Функционал реализован не полностью.

...
